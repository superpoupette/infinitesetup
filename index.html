<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Zoom Infini Test</title>
    <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
    <style>
        html, body { margin:0; padding:0; height:100%; }
        #viewer { width: 100%; height: 100vh; background-color: black; }
    </style>
</head>
<body>
<div id="viewer"></div>

<script>
var viewer = OpenSeadragon({
    id: "viewer",
    prefixUrl: "https://openseadragon.github.io/openseadragon/images/",
    tileSources: "sortie.dzi",
    showNavigator: false
});

let firstPoint = null;

viewer.addHandler('canvas-click', function(event){
    if(!event.position) return;

    let viewportPoint = viewer.viewport.pointFromPixel(event.position);
    let img = viewer.world.getItemAt(0);
    let imagePoint = viewer.viewport.viewportToImageCoordinates(viewportPoint);
    let imgSize = img.getContentSize();

    let normX = imagePoint.x / imgSize.x;
    let normY = imagePoint.y / imgSize.y;

    if(!firstPoint){
        firstPoint = { 
            normX: normX, 
            normY: normY,
            pxX: imagePoint.x,
            pxY: imagePoint.y
        };

        console.log("Coin haut gauche enregistré :", firstPoint);

    } else {
        let secondPoint = { 
            normX: normX, 
            normY: normY,
            pxX: imagePoint.x,
            pxY: imagePoint.y
        };

        // --- Normalisé (OpenSeadragon) ---
        let x = Math.min(firstPoint.normX, secondPoint.normX);
        let y = Math.min(firstPoint.normY, secondPoint.normY);
        let width = Math.abs(secondPoint.normX - firstPoint.normX);
        let height = Math.abs(secondPoint.normY - firstPoint.normY);

        // --- Pixels (GIMP) ---
        let pxX = Math.min(firstPoint.pxX, secondPoint.pxX);
        let pxY = Math.min(firstPoint.pxY, secondPoint.pxY);
        let pxW = Math.abs(secondPoint.pxX - firstPoint.pxX);
        let pxH = Math.abs(secondPoint.pxY - firstPoint.pxY);

        console.log("==== OPEN SEADRAGON (normalisé) ====");
        console.log(`x: ${x}`);
        console.log(`y: ${y}`);
        console.log(`width: ${width}`);
        console.log(`height: ${height}`);

        console.log("==== GIMP (pixels) ====");
        console.log(`Position X: ${Math.round(pxX)}`);
        console.log(`Position Y: ${Math.round(pxY)}`);
        console.log(`Largeur: ${Math.round(pxW)}`);
        console.log(`Hauteur: ${Math.round(pxH)}`);

        firstPoint = null;
    }
});
</script>
</body>
</html>




